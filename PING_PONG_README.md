# WebSocket Ping/Pong Implementation

## Описание

Реализован механизм ping/pong для поддержания WebSocket соединений между клиентом и сервером. Это помогает обнаруживать "мертвые" соединения и автоматически их закрывать.

## Функциональность

### Клиентская часть (React)
- **Keep-alive**: Отправляет PING каждые 60 секунд
- **Heartbeat**: Проверяет соединение каждые 10 секунд
- **Автоматическое переподключение**: При потере соединения с экспоненциальной задержкой

### Серверная часть (Node.js)
- **Обработка PING**: Получает PING и отправляет PONG обратно
- **Heartbeat мониторинг**: Проверяет все соединения каждые 30 секунд
- **Автоматическое закрытие**: Закрывает соединения без активности более 5 минут

## Файлы

### Новые файлы:
- `p2p/actions/pingActions.js` - обработка ping/pong и heartbeat
- `p2p/test-ping.js` - тестовый клиент для проверки функциональности

### Обновленные файлы:
- `p2p/socket/index.js` - добавлен heartbeat механизм
- `p2p/socket/parse.js` - поддержка простых строк PING
- `p2p/routes.js` - добавлен маршрут PING
- `p2p/actions/index.js` - экспорт новых функций

## Использование

### Запуск сервера:
```bash
cd p2p
npm run dev
```

### Тестирование ping/pong:
```bash
cd p2p
node test-ping.js
```

### Клиентское использование:
Клиент автоматически отправляет PING сообщения. Никаких дополнительных действий не требуется.

## Логирование

Сервер выводит следующие логи:
- `[PING] Pong sent to client {userId}` - при отправке pong
- `[HEARTBEAT] Client {userId} hasn't sent ping for {time}s, closing connection` - при закрытии мертвых соединений

## Настройки

### Таймауты:
- **Keep-alive интервал**: 60 секунд (клиент)
- **Heartbeat проверка**: 30 секунд (сервер)
- **Максимальное время без ping**: 5 минут (300 секунд)
- **Максимальные попытки переподключения**: 10 (клиент)

### Изменение настроек:
Настройки находятся в соответствующих файлах и могут быть легко изменены.
